// Generated by CoffeeScript 1.8.0
angular.module('Sonnets').controller('SonnetShowCtrl', function($scope, $document, $http, Pusher, $location, AnnotationCategories) {
  var sonnetId;
  sonnetId = /sonnets\/(\d+)/.exec($location.absUrl())[1];
  $http.get("/api/sonnets/" + sonnetId).success(function(data) {
    $scope.poem = data;
    return $scope.annotations = $scope.poem.annotations;
  });
  Pusher.subscribe('annotations_channel', 'new_annotation', function(poem) {
    return $scope.$apply(function() {
      return $scope.annotations = poem.annotations;
    });
  });
  $scope.submitAnnotation = function(e) {
    if (e.keyCode === 13) {
      $http.put("/api/sonnets/" + sonnetId + "/annotations", $scope.annotation);
      return $scope.annotation = null;
    }
  };
  return $scope.categories = AnnotationCategories;
});
